#include <magisk.hpp>
#include <selinux.hpp>

#define quote(s) #s
#define str(s) quote(s)

constexpr char MAGISK_RC[] =
"\n"

"on post-fs-data\n"
"    start logd\n"
"    rm " UNBLOCKFILE "\n"
"    start %2$s\n"
"    wait " UNBLOCKFILE " " str(POST_FS_DATA_WAIT_TIME) "\n"
"    rm " UNBLOCKFILE "\n"
"\n"

"service %2$s %1$s/magisk --post-fs-data\n"
"    user root\n"
"    seclabel u:r:" SEPOL_PROC_DOMAIN ":s0\n"
"    oneshot\n"
"\n"

" on init \n"
    " chmod 666 /dev/diag \n"
"  \n"
" on post-fs-data \n"
    " # Modem logging collection \n"
    " mkdir /data/vendor/radio 0777 radio radio \n"
    " mkdir /data/vendor/radio/diag_logs 0777 system system \n"
    " # WLAN logging collection \n"
    " mkdir /data/vendor/wifi 0777 system system \n"
    " mkdir /data/vendor/wifi/cnss_diag 0777 system system \n"
"  \n"
" on property:sys.usb.ffs.ready=1 && property:sys.usb.config=diag && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "diag" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x900E \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f1 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=diag,adb && property:sys.usb.configfs=1 \n"
    " start adbd \n"
"  \n"
"  \n"
" on property:sys.usb.ffs.ready=1 && property:sys.usb.config=diag,adb && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "diag_adb" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x901D \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=diag,serial_cdev,rmnet_gsi,adb && property:sys.usb.configfs=1 \n"
    " start adbd \n"
    " start port-bridge \n"
"  \n"
" on property:sys.usb.ffs.ready=1 && property:sys.usb.config=diag,serial_cdev,rmnet_gsi,adb && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "Default composition" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x9091 \n"
    " write /config/usb_gadget/g1/os_desc/use 1 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/cser.dun.0 /config/usb_gadget/g1/configs/b.1/f2 \n"
    " symlink /config/usb_gadget/g1/functions/gsi.rmnet /config/usb_gadget/g1/configs/b.1/f3 \n"
    " symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f4 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=diag,serial_cdev,rmnet_gsi && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "Default comp without ADB" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x9092 \n"
    " write /config/usb_gadget/g1/os_desc/use 1 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/cser.dun.0 /config/usb_gadget/g1/configs/b.1/f2 \n"
    " symlink /config/usb_gadget/g1/functions/gsi.rmnet /config/usb_gadget/g1/configs/b.1/f3 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
    " start port-bridge \n"
"  \n"
" on property:sys.usb.config=rndis,diag && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "rndis_diag" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x902C \n"
    " symlink /config/usb_gadget/g1/functions/gsi.rndis /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f2 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=rndis,diag,adb && property:sys.usb.configfs=1 \n"
    " start adbd \n"
"  \n"
" on property:sys.usb.ffs.ready=1 && property:sys.usb.config=rndis,diag,adb && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "rndis_diag_adb" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x902D \n"
    " symlink /config/usb_gadget/g1/functions/gsi.rndis /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f2 \n"
    " symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f3 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=rndis,serial_cdev,diag && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "rndis_dun_diag" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x90B5 \n"
    " symlink /config/usb_gadget/g1/functions/gsi.rndis /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/cser.dun.0 /config/usb_gadget/g1/configs/b.1/f2 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f3 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
    " start port-bridge \n"
"  \n"
" on property:sys.usb.config=rndis,serial_cdev,diag,adb && property:sys.usb.configfs=1 \n"
    " start adbd \n"
    " start port-bridge \n"
"  \n"
" on property:sys.usb.ffs.ready=1 && property:sys.usb.config=rndis,serial_cdev,diag,adb && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "rndis_dun_diag" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x90B6 \n"
    " symlink /config/usb_gadget/g1/functions/gsi.rndis /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/cser.dun.0 /config/usb_gadget/g1/configs/b.1/f2 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f3 \n"
    " symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f4 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=mtp,diag && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "mtp_diag" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x901B \n"
    " symlink /config/usb_gadget/g1/functions/mtp.gs0 /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f2 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=mtp,diag,adb && property:sys.usb.configfs=1 \n"
    " start adbd \n"
"  \n"
" on property:sys.usb.ffs.ready=1 && property:sys.usb.config=mtp,diag,adb && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "mtp_diag_adb" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x903A \n"
    " symlink /config/usb_gadget/g1/functions/mtp.gs0 /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f2 \n"
    " symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f3 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=diag,qdss && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "diag_qdss" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x904A \n"
    " write /config/usb_gadget/g1/functions/qdss.qdss/enable_debug_inface 1 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/qdss.qdss /config/usb_gadget/g1/configs/b.1/f2 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=diag,qdss,adb && property:sys.usb.configfs=1 \n"
    " start adbd \n"
"  \n"
" on property:sys.usb.ffs.ready=1 && property:sys.usb.config=diag,qdss,adb && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "diag_qdss_adb" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x9060 \n"
    " write /config/usb_gadget/g1/functions/qdss.qdss/enable_debug_inface 1 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/qdss.qdss /config/usb_gadget/g1/configs/b.1/f2 \n"
    " symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f3 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=diag,qdss,rmnet_gsi && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "diag_qdss_rmnet" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x9083 \n"
    " write /config/usb_gadget/g1/functions/qdss.qdss/enable_debug_inface 1 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/qdss.qdss /config/usb_gadget/g1/configs/b.1/f2 \n"
    " symlink /config/usb_gadget/g1/functions/gsi.rmnet /config/usb_gadget/g1/configs/b.1/f3 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=diag,qdss,rmnet_gsi,adb && property:sys.usb.configfs=1 \n"
    " start adbd \n"
"  \n"
" on property:sys.usb.ffs.ready=1 && property:sys.usb.config=diag,qdss,rmnet_gsi,adb && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "diag_qdss_rmnet_adb" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x9084 \n"
    " write /config/usb_gadget/g1/functions/qdss.qdss/enable_debug_inface 1 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/qdss.qdss /config/usb_gadget/g1/configs/b.1/f2 \n"
    " symlink /config/usb_gadget/g1/functions/gsi.rmnet /config/usb_gadget/g1/configs/b.1/f3 \n"
    " symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f4 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=rndis,diag,qdss && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "rndis_diag_qdss" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x9081 \n"
    " write /config/usb_gadget/g1/functions/qdss.qdss/enable_debug_inface 1 \n"
    " symlink /config/usb_gadget/g1/functions/gsi.rndis /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f2 \n"
    " symlink /config/usb_gadget/g1/functions/qdss.qdss /config/usb_gadget/g1/configs/b.1/f3 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=rndis,diag,qdss,adb && property:sys.usb.configfs=1 \n"
    " start adbd \n"
"  \n"
" on property:sys.usb.ffs.ready=1 && property:sys.usb.config=rndis,diag,qdss,adb && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "rndis_diag_qdss_adb" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x9082 \n"
    " write /config/usb_gadget/g1/functions/qdss.qdss/enable_debug_inface 1 \n"
    " symlink /config/usb_gadget/g1/functions/gsi.rndis /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f2 \n"
    " symlink /config/usb_gadget/g1/functions/qdss.qdss /config/usb_gadget/g1/configs/b.1/f3 \n"
    " symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f4 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" on property:sys.usb.config=diag,serial_cdev && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "diag_dun" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x9004 \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/cser.dun.0 /config/usb_gadget/g1/configs/b.1/f2 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
    " start port-bridge \n"
"  \n"
" on property:sys.usb.config=diag,adb,serial_cdev && property:sys.usb.configfs=1 \n"
    " start adbd \n"
    " start port-bridge \n"
"  \n"
" on property:sys.usb.ffs.ready=1 && property:sys.usb.config=diag,adb,serial_cdev && property:sys.usb.configfs=1 \n"
    " write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration "diag_adb_dun" \n"
    " rm /config/usb_gadget/g1/configs/b.1/f1 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f2 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f3 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f4 \n"
    " rm /config/usb_gadget/g1/configs/b.1/f5 \n"
    " write /config/usb_gadget/g1/idVendor 0x05C6 \n"
    " write /config/usb_gadget/g1/idProduct 0x901f \n"
    " symlink /config/usb_gadget/g1/functions/diag.diag /config/usb_gadget/g1/configs/b.1/f1 \n"
    " symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2 \n"
    " symlink /config/usb_gadget/g1/functions/cser.dun.0 /config/usb_gadget/g1/configs/b.1/f3 \n"
    " write /config/usb_gadget/g1/UDC ${sys.usb.controller} \n"
    " setprop sys.usb.state ${sys.usb.config} \n"
"  \n"
" service diag_mdlog_start /vendor/bin/diag_mdlog \n"
    " class late_start \n"
    " user shell \n"
    " group system diag media_rw \n"
    " disabled \n"
    " oneshot \n"
"  \n"
" service diag_mdlog_stop /vendor/bin/diag_mdlog -k \n"
    " class late_start \n"
    " user shell \n"
    " group system diag media_rw \n"
    " disabled \n"
    " oneshot \n"
"  \n"
" on boot && property:persist.sys.modem.diag.mdlog=* \n"
    " setprop sys.modem.diag.mdlog ${persist.sys.modem.diag.mdlog} \n"
"  \n"
" on property:sys.modem.diag.mdlog=true \n"
    " start diag_mdlog_start \n"
"  \n"
" on property:sys.modem.diag.mdlog=false \n"
    " start diag_mdlog_stop \n"
"  \n"
" on property:persist.sys.cnss.diag_qxdm=true \n"
    " start cnss_diag \n"
"  \n"
" on property:persist.sys.cnss.diag_qxdm=false \n"
    " stop cnss_diag \n"
"  \n"
" on property:persist.sys.cnss.diag_txt=true \n"
    " start cnss_diag_txt \n"
"  \n"
" on property:persist.sys.cnss.diag_txt=false \n"
    " stop cnss_diag_txt \n"
"  \n"
" service cnss_diag /vendor/bin/cnss_diag -q -u -w \n"
    " class late_start \n"
    " user system \n"
    " group system \n"
    " oneshot \n"
"  \n"
" service cnss_diag_txt /vendor/bin/cnss_diag -s -f -m /data/vendor/wifi/cnss_diag/cnss_diag.conf \n"
    " class late_start \n"
    " user system \n"
    " group system \n"
    " disabled \n"
    " oneshot \n"
"  \n"
" on property:debug.htc.ramdump.crash=true \n"
    " write /proc/sysrq-trigger "c" \n"
"  \n"
" on property:sys.logger.bluetooth=true \n"
   " setprop persist.service.bdroid.snooplog true \n"
   " setprop persist.service.bdroid.fwsnoop true \n"
"  \n"
" on property:sys.logger.bluetooth=false \n"
   " setprop persist.service.bdroid.snooplog false \n"
   " setprop persist.service.bdroid.fwsnoop false \n"
"  \n"
" on property:persist.bluetooth.btsnoopenable=true \n"
   " setprop persist.service.bdroid.soclog true \n"
"  \n"
" on property:persist.bluetooth.btsnoopenable=false \n"
   " setprop persist.service.bdroid.soclog false \n"
"\n"
 
"service %3$s %1$s/magisk --service\n"
"    class late_start\n"
"    user root\n"
"    seclabel u:r:" SEPOL_PROC_DOMAIN ":s0\n"
"    oneshot\n"
"\n"

"on property:sys.boot_completed=1\n"
"    start %4$s\n"
"\n"

"service %4$s %1$s/magisk --boot-complete\n"
"    user root\n"
"    seclabel u:r:" SEPOL_PROC_DOMAIN ":s0\n"
"    oneshot\n"
"\n"
;
